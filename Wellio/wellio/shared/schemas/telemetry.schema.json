{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Telemetry",
  "oneOf": [
    {
      "type": "object",
      "required": ["kind", "userId", "device", "source", "ts", "bpm"],
      "properties": {
        "kind": { "const": "heart_rate" },
        "userId": { "type": "string" },
        "device": { "$ref": "#/definitions/device" },
        "source": { "$ref": "#/definitions/source" },
        "ts": { "type": "string", "format": "date-time" },
        "bpm": { "type": "number", "minimum": 0 },
        "meta": { "$ref": "#/definitions/meta" }
      },
      "additionalProperties": false
    },
    {
      "type": "object",
      "required": ["kind", "userId", "device", "source", "ts", "steps"],
      "properties": {
        "kind": { "const": "steps" },
        "userId": { "type": "string" },
        "device": { "$ref": "#/definitions/device" },
        "source": { "$ref": "#/definitions/source" },
        "ts": { "type": "string", "format": "date-time" },
        "steps": { "type": "integer", "minimum": 0 },
        "window": { "type": "string" }
      },
      "additionalProperties": false
    },
    {
      "type": "object",
      "required": ["kind", "userId", "device", "source", "ts", "stage", "dur_s"],
      "properties": {
        "kind": { "const": "sleep" },
        "userId": { "type": "string" },
        "device": { "$ref": "#/definitions/device" },
        "source": { "$ref": "#/definitions/source" },
        "ts": { "type": "string", "format": "date-time" },
        "stage": { "type": "string", "enum": ["light", "deep", "rem", "awake"] },
        "dur_s": { "type": "number", "minimum": 0 }
      },
      "additionalProperties": false
    }
  ],
  "definitions": {
    "device": {
      "type": "object",
      "properties": {
        "vendor": { "type": "string" },
        "model": { "type": "string" },
        "id": { "type": "string" },
        "firmware": { "type": "string" }
      },
      "additionalProperties": false
    },
    "source": {
      "type": "string",
      "enum": [
        "healthkit",
        "health_connect",
        "ble",
        "vendor_fitbit",
        "vendor_garmin",
        "vendor_oura",
        "vendor_withings"
      ]
    },
    "meta": {
      "type": "object",
      "properties": {
        "sampling_hz": { "type": "number", "minimum": 0 },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 }
      },
      "additionalProperties": false
    }
  }
}
